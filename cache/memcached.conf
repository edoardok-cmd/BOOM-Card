# Memcached Configuration for BOOM Card Platform
# Production environment settings

# Basic Settings
-p 11211
-U 11211
-l 127.0.0.1
-u memcache
-c 10240
-m 2048
-M
-I 10m
-f 1.25
-n 48
-t 4
-v

# Network Settings
-R 20
-b 1024
-B binary

# Memory Settings
# 2GB max memory (-m 2048)
# Disable evictions when memory limit reached (-M)
# Maximum item size 10MB (-I 10m)
# Growth factor 1.25 (-f 1.25)

# Performance Settings
# 4 threads (-t 4)
# 10240 max connections (-c 10240)
# 48 byte minimum item size (-n 48)

# Security Settings
# Disable UDP (-U 0)
# Bind to localhost only (-l 127.0.0.1)
# Run as memcache user (-u memcache)
# Enable SASL authentication
-S

# Logging
# Verbose output (-v)
# Log file location
-vv >> /var/log/memcached/memcached.log 2>&1

# Stats Settings
# Enable detailed stats
-D :
-L

# Slab Settings
# Slab reassignment
-o slab_reassign,slab_automove=1

# Modern Optimizations
-o hashpower=16
-o tail_repair_time=100
-o lru_crawler,lru_crawler_sleep=100,lru_crawler_tocrawl=0
-o lru_maintainer,hot_lru_pct=20,warm_lru_pct=40
-o expirezero_does_not_evict
-o maxconns_fast
-o no_lru_crawler

# Connection Timeout
-o idle_timeout=300

# Protocol Settings
# Binary protocol for better performance
-B binary

# Enable CAS (Check And Set)
-C

# Extended Options
-o ext_item_size=512
-o ext_item_age=900
-o ext_path=/var/cache/memcached/extstore:64G
-o ext_threads=2
-o ext_max_frag=0.8
-o ext_drop_under=0

# Watchdog Settings
-o watcher_logbuf_size=256
-o worker_logbuf_size=256

# Hash Table Settings
-o hashpower=17
-o hash_algorithm=murmur3

# Memory Efficiency
-o modern
-o inline_ascii_resp
-o no_inline_ascii_resp

# BOOM Card Specific Settings
# Cache zones for different data types

# User sessions: High priority, 30 min expiry
# Partner data: Medium priority, 5 min expiry  
# Analytics: Low priority, 1 min expiry
# Static content: High priority, 1 hour expiry

# Namespace Prefixes
# sess: - User sessions
# user: - User profiles
# partner: - Partner data
# deal: - Active deals
# loc: - Location data
# stats: - Analytics data
# qr: - QR code validations
# trans: - Transaction cache
# api: - API response cache

# Health Check
# Enable stats socket for monitoring
-s /var/run/memcached/memcached.sock
-a 0766

# Startup Options
# Daemon mode
-d
-P /var/run/memcached/memcached.pid

# Performance Monitoring
# Track hit rates, evictions, and connection stats
# Monitor via stats command on telnet interface

# Maintenance Windows
# Scheduled restarts: Sunday 3AM local time
# Memory defragmentation: Daily 2AM
# Stats collection: Every 5 minutes

# Backup Strategy
# Warm cache on startup from Redis
# Periodic sync with persistent storage
# Graceful degradation on cache miss

# Security Hardening
# SASL authentication required
# TLS support for client connections
# IP whitelist for production servers
# Rate limiting per connection

# Monitoring Alerts
# Memory usage > 80%
# Connection count > 8000
# Eviction rate > 100/sec
# Hit rate < 90%
# Response time > 5ms
